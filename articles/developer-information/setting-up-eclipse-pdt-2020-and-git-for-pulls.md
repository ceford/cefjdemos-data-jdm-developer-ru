<!-- Filename: Setting_up_Eclipse_PDT_2020_and_Git_for_Pulls / Display title: Настройка Eclipse PDT 2020 и Git для Pulls -->

## Введение

Я впервые начал использовать Eclipse много лет назад для частного проекта Joomla и частного удаленного репозитория git, не на Github. Я прочитал доступные руководства и с удовольствием путался до этого года, когда решил попробовать помочь с основным тестированием и исправлением ошибок для Joomla! 4. А затем появились некоторые pull-запросы. Тогда я осознал, что не совсем понимал, что именно делаю. В конце концов, я решил начать заново и задокументировать процесс для других полуопытных разработчиков, которые новички в Joomla, особенно те части, которые я не до конца оценил в первый раз. Первое в списке:

## Структура файлов

Не очевидно до того, как вы загрузите и установите Eclipse, что существует как минимум два места, где хранятся данные помимо того, где расположен код Eclipse.

### Рабочая область

Здесь Eclipse хранит свои собственные данные для каждого проекта. Они не должны находиться в веб-дереве! Так как я в основном работаю на ноутбуке Mac, то по умолчанию расположение для меня — **/Users/username/eclipse-workspace**. Для каждого проекта есть подкаталог. Таким образом, один из них может быть **/Users/username/eclipse-workspace/joomla-cms**. Он содержит одну папку: .metadata. Пользователи Linux, вероятно, знают, что вместо Users следует использовать home.

### Локальный репозиторий git и тестовый веб-сайт

Здесь хранится код проекта. Это может быть в локальном дереве веб, если вы хотите использовать его для тестирования. Для меня это **/Users/username/Sites/joomla-cms-4**. Пользователи Linux, вероятно, знают, что нужно заменить Sites на public_html. Обратите внимание на дополнительные шаги, необходимые для работы локального репозитория как сайта Joomla.

### Отдельный тестовый веб-сайт

Это необязательно, но требует, чтобы репозиторий git имел файл build.xml, например build-local.xml, описанный в приложении.

## Требуемое программное обеспечение

Чтобы настроить рабочий сайт для разработки и тестирования, вам сначала нужно установить следующее программное обеспечение:

- Apache
- MySQL или MariaDB
- PHP
- phpMyAdmin - [PhpMyAdmin Домашняя страница](https://www.phpmyadmin.net/)
- Composer - [Composer Домашняя страница](https://getcomposer.org/)
- Node.js - [Node.js Домашняя страница](https://nodejs.org/en/)
- Eclipse PDT - [Eclipse Инструменты разработки PHP](https://www.eclipse.org/pdt/)
- git (опционально для пользователей командной строки git) - [git Домашняя страница](https://git-scm.com/)
- phing (опционально для кастомных сборок) - [phing Домашняя страница](https://www.phing.info/)

Первые три или четыре часто поставляются в комплекте для вашей платформы, известном как LAMP, WAMP или XAMP стек. Просто используйте то, что предлагает ваша платформа, или посмотрите на Apache Friends [XAMPP](https://www.apachefriends.org/)

Предположим, вы установили все, кроме Eclipse.

## Форк joomla-cms на Github

В [Мой первый pull-запрос в Joomla! на Github](https://docs.joomla.org/My_first_pull_request_to_Joomla!_on_Github) описан рабочий процесс, о котором я не могу не говорить с большой похвалой. Он показывает точно, что нужно сделать:

![Github work flow](../../../en/images/getting-started/core-work-flow-joomla.png)

Шаги

- Перейдите на [Github](https://github.com/) и зарегистрируйте аккаунт, это бесплатно и быстро.
- В своем аккаунте на github перейдите в репозиторий joomla/joomla-cms: введите joomla/joo... в поле поиска в левом верхнем углу и выберите, когда появятся варианты.
- В репозитории joomla/joomla-cms нажмите кнопку fork в правом верхнем углу. Это создаст ответвленную копию всего кода для Joomla 4, Joomla 5, ..., всего, в вашем собственном аккаунте на Github.

Вернуться на свое рабочее место.

## Установить Eclipse

У меня уже установлены две версии Eclipse: Oxygen нескольких лет назад и Cocoa 2020 года. Отсюда я устанавливаю второй экземпляр Cocoa. Посмотрим, что произойдет:

- Перейдите на [сайт Eclipse](https://www.eclipse.org/pdt/) и загрузите версию для вашей платформы.
- Следуйте процедуре установки и в конечном итоге запустите приложение Eclipse, для меня это **Eclipse 2.app**.
- Предупреждение: *Eclipse 2.app* — это приложение, загруженное из интернета. Вы уверены, что хотите открыть его? **Открыть**
- Выберите каталог в качестве рабочей области - По умолчанию это /Users/username/eclipse-workspace. **Обзор** и создайте подкаталог joomla-cms-4.
- Запуск: Eclipse установлен и отображает страницу приветствия.
- Просмотрите настройки конфигурации IDE. Установите пункты 1, 2, 5 и 6.
- Выберите значок Workbench в правом верхнем углу.

Вместо установки другой версии Eclipse, я мог бы открыть новое пустое рабочее пространство.

Пока все хорошо!

## Импорт форка в Eclipse

В вашей новой локальной установке Eclipse:

- Откройте настройки и установите Team / Git / Default repository folder в /Users/username/git (вы можете использовать это местоположение или нет)
- Откройте Файл / Импорт / Git / Проекты из Git (со smart import). Далее ...
- Клонировать URI. Далее ...
- Скопируйте адресную строку из **вашего форка на Github** и вставьте его в поле URL. Вам не нужно добавлять учетные данные для аутентификации. Далее ...
- Ветки для импорта ... эм... Вероятно, лучше всего импортировать все. Далее ...
- Директория. Здесь вы можете выбрать другое место для хранения кода. Я перешел в /Users/username/public_html/joomla-cms-4, создав его при необходимости.
- Начальная ветка - если вы импортировали все ветки. Я работаю с Joomla 4, поэтому выбрал 4.0-dev. И я отметил, что мой клон будет **origin**. Далее ...
- Глоток кофе. Клонирование займет несколько минут.
- Импорт источника. Источник должен быть местоположением кода. Завершить.
- Eclipse теперь показывает корень дерева кода в панели проводника проекта. Щелкните, чтобы увидеть больше дерева. Обратите внимание, что этот код пока не будет работать как сайт Joomla. Среди прочего, нет папки media.

## Добавьте исходный репозиторий joomla-cms в Eclipse

- Показать окно Git Repositories: выберите Window / Show View / Other
- Выберите Git / Git Repositories - окно появится в нижней части экрана.
- Разверните joomla-cms / remotes / origin - если вы вносите изменения в свой код и отправляете в origin, то они попадают сюда.
- Щелкните правой кнопкой мыши на Remotes и выберите Create Remote...
- Установите имя Remote в **joomla-origin** и выберите **Configure fetch**.
- В Configure Fetch выберите **Change**.
- В Select a URI вставьте URL оригинального репозитория joomla-cms: `https://github.com/joomla/`
- Оставьте поле Credentials пустым. Завершите.
- в Configure Fetch: **Save and Fetch**.

## Создание рабочего сайта

Ваша копия кода joomla-cms требует дополнительных шагов, чтобы сделать её пригодной для использования в качестве веб-сайта.

- Откройте терминал и перейдите в папку, содержащую ваш клонированный код.
- Запустите composer install:
  - Пользователи Linux и OSX могут настроить следующий bash-алиас, добавив в `~/.bash_profile` или файл `~/.zsh` (чтобы изменения вступили в силу сразу, выполните `\$ source ~/.bash_profile`):
```sh
    alias jclean="rm -rf administrator/templates/atum/css; \
    rm -rf templates/cassiopeia/css; \
    rm -rf administrator/templates/system/css; \
    rm -rf templates/system/css; \
    rm -rf media/; \
    rm -rf node_modules/; \
    rm -rf libraries/vendor/; \
    rm -f administrator/cache/autoload_psr4.php; \
    rm -rf installation/template/css"
    alias jinstall="jclean; composer install --ignore-platform-reqs; npm ci"
```

- composer отсутствует в моем пути, поэтому я заменил его на php ~/composer/composer.phar
- jinstall
- который загружает все PHP-зависимости Joomla, Javascript-зависимости, компилирует весь Javascript ES6 и помещает файлы в соответствующие места.
- глоток кофе, пока зависимости загружаются и создаются медиафайлы.
- В Eclipse щелкните правой кнопкой мыши на корне проекта и выберите Обновить. Вы увидите, что в вашем коде теперь есть папка media.
- Если вам интересно, используйте файловый менеджер, чтобы увидеть, что в корне также содержится файл с именем .gitignore и в нём упоминается папка media. Это значит, что она не будет добавлена в ваши локальные или удалённые форкнутые git-репозитории.

Теперь вы готовы к установке Joomla:

- Создайте базу данных с помощью phpMyAdmin (или командной строки mysql, если предпочитаете).
- Я создал базу данных с именем joomla-cms-4 с сопоставлением utf8mb4-unicode-ci.
- Создайте нового пользователя: мой jcms4 с сгенерированным случайным паролем (GAOC26r77bBLkkdA). Вам нужно записать пароль для использования во время установки. Он хранится в обычном тексте в файле конфигурации.
- Предоставьте все привилегии на базу данных этому пользователю - по умолчанию.
- В вашем любимом браузере перейдите в корень нового сайта: localhost/joomla-cms-4/

### На моем Mac с установленной macOS Catalina

- Настройка окружения не завершена: Подробнее. Ох - просто исправьте это и проверьте, что в адресной строке есть введённый вами URL - у меня каким-то образом добавились лишние символы.
- В противном случае он переходит на рабочий сайт - не удаляйте папку с установочными файлами.

### На моей рабочей станции Linux с установленной Linux Mint 20

Упс! Что-то пошло не так!

Проблема заключается в том, что мой код Joomla находится в моем личном файловом пространстве для доступа на чтение/запись через Eclipse. Веб-серверу также нужен доступ на запись для конфигурации, кеша и лог-файлов, но он работает как пользователь и группа с низкими привилегиями. Поскольку я нахожусь в домашней частной сети, я отредактировал /etc/apache2/apache2.conf, чтобы закомментировать User \${APACHE_RUN_USER} и Group \${APACHE_RUN_GROUP}, и добавил User myusername и Group mygroupname. Перезапустите apache, затем...

- Он ведет к работающему сайту - не удаляйте папку установки.

## Ревизия кода

Кратко:

- Выполнить fetch из joomla-origin, чтобы убедиться, что мой локальный клон актуален.
- Команда / Слияние / Выбрать ветку для слияния - осторожно - я выбрал joomla-origin/4.0-dev
- Выполнить push в origin, чтобы убедиться, что мой удаленный форк актуален.
- Создать ветку для некоторых изменений в коде, которые я хочу сделать.
- Внести изменения в код
- Если изменения касаются css или js файлов-источников (тех, что в sass или es6), откройте терминал и выполните jinstall снова.
- ПРОВЕРЬТЕ вашу локальную установку, чтобы узнать, есть ли какие-либо проблемы.
- Закоммитить изменения в коде
- Выполнить push в origin, чтобы обновить мой удаленный форк с моими изменениями.
- Перейдите к своему аккаунту на Github и выберите ветку, которую вы создали с обновленным кодом. Что-то страшное: написано **Эта ветка содержит на 11084 коммита больше и отстает на 134 коммита от joomla:staging.** Я что-то сделал не так? По-видимому, нет!
- Выберите кнопку Pull Request. Убедитесь, что выбрали правильную ветку joomla для слияния. Для меня это 4.0-dev. И убедитесь, что выбрана ваша ветка с измененным кодом. Действуйте!
- Запрос на слияние должен быть протестирован и одобрен, и это может занять дни, недели или месяцы. И изменения могут быть отклонены!

## Тем временем

Возвращаемся к вашей рабочей станции:

- Переключитесь обратно на вашу оригинальную ветку: Team / Switch To / 4.0-dev
- Перестройте: Project / Build Project
- Убедитесь, что файлы, измененные ранее, копируются обратно на ваш рабочий сайт.
- ТЕСТ: ваш рабочий сайт возвращается к состоянию до внесения изменений в код.

Теперь вы готовы создать другую ветку для очередного набора изменений в коде.

## В случае бедствия

На одном из этапов мой локальный клон каким-то образом стал поврежден, и я не знал, как это исправить. Поэтому я удалил мой локальный клон и все связанные с ним файлы, очистил базу данных, а затем вернулся к этапу **Импорт вилки в Eclipse**, описанному выше. Это синхронизировало мой локальный клон с удаленной вилкой, включая любые ветки, которые я создал для pull-запросов. Новая установка прошла гладко, и я был доволен!

## Другие ресурсы

- [Настройка Eclipse для разработки Joomla](https://docs.joomla.org/Configuring_Eclipse_for_joomla_development) (2012-2013) Но получите последнюю версию Eclipse PDT!
- [Мой первый pull request в Joomla! на Github](https://docs.joomla.org/My_first_pull_request_to_Joomla!_on_Github) (2011-2014) Хороший обзор, хотя и немного устаревший.
- [Работа с git и github](https://docs.joomla.org/Working_with_git_and_github) (2011-2015)
- [Настройка локальной среды](https://docs.joomla.org/J4.x:Setting_Up_Your_Local_Environment) (2018-2020)
- [Настройка Eclipse и Xdebug](https://docs.joomla.org/Configuring_Eclipse_and_Xdebug) (2013) Всё о отладке.
- [Работа с Git и Eclipse](https://docs.joomla.org/Working_with_Git_and_Eclipse) (2014) Метод для старых версий Eclipse.
- [Запуск автоматизированных тестов из Eclipse](https://docs.joomla.org/Running_Automated_Tests_from_Eclipse) (2020) Для продвинутых пользователей?
- [Настройка Xdebug для разработки PHP/Linux](https://docs.joomla.org/Configuring_Xdebug_for_PHP_development/Linux) (2016) Установка и настройка.
- [Настройка Eclipse IDE для разработки PHP/Linux](https://docs.joomla.org/Configuring_Eclipse_IDE_for_PHP_development/Linux) (2019) Установка и настройка для Linux.
- [Настройка Xdebug для разработки PHP](https://docs.joomla.org/Configuring_Xdebug_for_PHP_development) (2014) Шаги для Linux, Windows и Mac OS X.
- [Вебинар: Использование Eclipse для разработки Joomla!](https://docs.joomla.org/Webinar:_Using_Eclipse_for_Joomla!_Development) (2014) Это 45-минутное видео-вебинар, записанное 30 апреля 2009 года, предоставляет обзор возможностей Eclipse для разработки Joomla!
- [Настройка рабочей станции для разработки Joomla](https://docs.joomla.org/Setting_up_your_workstation_for_Joomla_development) (2020) Краткий обзор необходимого программного обеспечения и альтернативных IDE.

## Приложение

На одном этапе у меня был локальный репозиторий git вне корневого каталога моего веб-сайта, и мне нужно было копировать любые изменения, сделанные мной, на отдельно установленный локальный сайт. Для этого требовался файл пользовательской сборки, показанный здесь для справки:

### Создайте файл build-local.xml

Клон Eclipse содержит файл build.xml, но он используется для тестирования и создания загружаемого zip-файла для новой установки. Что я хочу сделать, так это скопировать любые изменения, которые я вношу в свой клонированный код, на мой тестовый сайт на моем ноутбуке. Обратите внимание, что я хочу вносить изменения только в код PHP, а не в Javascript или CSS. Для этого я создал отдельный файл с именем build-local.xml в корне проекта:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project name="joomla-cms" basedir="." default="main">
    <property file=".project" />

    <property name="joomladir" value="/Users/username/public_html/joomla-cms"  override="true" />

    <property name="srcdir" value="${project.basedir}" override="true" />

    <!-- Fileset for all files -->
    <fileset dir="${srcdir}" id="allfiles">
        <include name="administrator/**" />
        <include name="api/**" />
        <include name="cli/**" />
        <include name="components/**" />
        <include name="images/**" />
        <include name="includes/**" />
        <include name="language/**" />
        <include name="layouts/**" />
        <include name="libraries/**" />
        <include name="modules/**" />
        <include name="plugins/**" />
        <include name="templates/**" />
        <include name="index.php" />

        <exclude name="**/.*" />
    </fileset>

    <!-- ============================================  -->
    <!-- (DEFAULT) Target: main                        -->
    <!-- ============================================  -->
    <target name="main" description="main target">
        <copy todir="${joomladir}">
            <fileset refid="allfiles" />
        </copy>
    </target>
</project>
```

### Добавить инструмент сборки

- Щелкните правой кнопкой мыши на корне проекта и выберите Свойства.
- Выберите Сборщики / Новый / Программа / OK.
- Имя: Локальная сборка с использованием phing
- Расположение: где бы ни был установлен phing. У меня это /usr/local/php5/bin/phing, хотя я использую PHP 7.4.
- Рабочая директория: Просмотреть рабочее пространство и выбрать joomla-cms - отображается как \${workspace_loc:/joomla-cms}
- Аргументы: -f build-local.xml
- Применить / OK
- В Сборщиках: Применить и Закрыть
- Проект / Сборка проекта
- Посмотрите, что произойдет:

```sh
    Buildfile: /Users/username/git/joomla-cms/build-local.xml
     [property] Loading /Users/username/git/joomla-cms/.project

    joomla-cms > main:

    BUILD FINISHED

    Total time: 0.2121 seconds
```

*Переведено на openai.com*

