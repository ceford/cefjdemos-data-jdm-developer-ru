<!-- Filename: Visual_Studio_Code_Primer / Display title: Visual Studio Code -->

## VS Code - популярная бесплатная среда разработки (IDE)

Из [Википедии](https://en.wikipedia.org/wiki/Visual_Studio_Code):

> Visual Studio Code, также часто называемый VS Code, — это редактор исходного кода, созданный Microsoft для Windows, Linux и macOS. 
> Возможности включают поддержку отладки, подсветку синтаксиса, интеллектуальное дополнение кода, сниппеты, рефакторинг кода и встроенный Git. 
> Пользователи могут изменять тему, сочетания клавиш, настройки и устанавливать расширения, которые добавляют дополнительную функциональность.

## Установка

Сайт [VS Code](https://code.visualstudio.com/) на странице по умолчанию имеет выпадающий список для каждой поддерживаемой платформы. Скорее всего, ваша платформа выбрана по умолчанию. Так что скачайте и установите, и вы готовы начать работать.

### Начало работы

Страница *Начало работы* в VS Code содержит некоторые элементы *Начало*, список *Недавние* элементы и короткий список *Обзоров*. Если вы совсем новичок в VS Code, рекомендуется ознакомиться с ними. Это займет всего несколько минут.

Документация VS Code доступна в меню *Справка / Документация*. Вводные видео однозначно стоит посмотреть. Каждое из них длится от 2 до 6 минут и дает отличный обзор возможностей VS Code:

[Видео VS Code](https://code.visualstudio.com/docs/getstarted/introvideos)

Официальная документация — это место, куда следует обратиться, если вы хотите найти конкретную информацию.

### Расширения VS Code

VS Code можно использовать для любого типа текста, включая широкий спектр языков программирования. Он работает с JavaScript без установки дополнительных расширений. Другие языки обнаруживаются по контексту, поэтому, если вы начнете создавать и сохранять код на PHP, вам, вероятно, предложат установить пакет поддержки PHP.

Нажмите на значок *Расширения* в левой *Панели действий*, чтобы увидеть, что у вас установлено и что рекомендуется. Вам потребуется расширение PHP Debug!

### Раскладка экрана VS Code

Некоторые термины, используемые в последующих инструкциях:

- **Панель активности:** узкая панель слева от экрана. Выберите любой значок, чтобы открыть или закрыть основную боковую панель.
- **Основная боковая панель:** отображает детали выбранной активности, когда открыта.
- **Строка состояния:** внизу экрана. Показывает, что происходит.
- **Панель:** область под текстовыми редакторами для отображения другой информации.

Выберите значок макета в правом верхнем углу, чтобы открыть или закрыть любой из этих элементов.

## Создание расширения Joomla

Чтобы создать расширение, ваша цель — создать zip-файл, который можно установить на работающий сайт Joomla. Поэтому вам нужна папка для размещения вашего кода. Она должна находиться в личном файловом пространстве на вашем ноутбуке или настольном компьютере, используемом для локальной разработки. Она не должна находиться в дереве вашего веб-сайта. Например, вы можете использовать *~/jextensions* для размещения подпапок для разных расширений. Я использую *~/git*, потому что это коротко и легко произносится, хотя потенциально это может вызывать путаницу, поскольку каждая подпапка использует отдельный репозиторий git.

### Пример кода

Если вы хотите поработать с образцом кода, на GitHub доступно расширение под названием *mod_debugme*. Как следует из названия, это модуль с некоторыми ошибками. Помимо кода модуля, есть файл *build.xml*, который иллюстрирует один из способов автоматизации сборки для тестирования и создания zip-файла.

Модуль предназначен для отображения нескольких следующих (по умолчанию 3) событий (дней рождений) из списка, хранящегося в таблице базы данных. Вы можете представить себе его использование в офисе или на семейном сайте в ожидании торта.

Может быть лучше начать использовать команды git из командной строки. Сначала создайте папку для вашего кода, а затем клонируйте удаленный репозиторий:

```sh
    mkdir ~/git
    cd ~/git
    git clone https://github.com/ceford/j4xdemos-mod-debugme
```

Ответ должен занять всего несколько секунд:

```sh
    Cloning into 'j4xdemos-mod-debugme'...
    remote: Enumerating objects: 23, done.
    remote: Counting objects: 100% (23/23), done.
    remote: Compressing objects: 100% (16/16), done.
    remote: Total 23 (delta 3), reused 23 (delta 3), pack-reused 0
    Unpacking objects: 100% (23/23), done.
```

Вы должны выделить время, чтобы взглянуть на содержимое папки:

```sh
    cd j4xdemos-mod-debugme
    ls -al
    total 16
    drwxr-xr-x   6 ceford  staff   192  2 Sep 17:48 .
    drwxr-xr-x   3 ceford  staff    96  2 Sep 17:48 ..
    drwxr-xr-x  12 ceford  staff   384  2 Sep 17:48 .git
    -rw-r--r--   1 ceford  staff  1402  2 Sep 17:48 README.md
    -rw-r--r--   1 ceford  staff   927  2 Sep 17:48 build.xml
    drwxr-xr-x   8 ceford  staff   256  2 Sep 17:48 mod_debugme
```

Папка *.git* содержит информацию о репозитории. Файл *README.md* является markdown-документом, который описывает этот репозиторий. Файл *build.xml* используется для сборки расширения с помощью внешнего инструмента, Phing - описанный позже. Папка *mod_debugme* содержит код расширения.

### Установка в Joomla

Сожмите папку расширения, чтобы создать установочный zip-файл:

```sh
    zip -r mod_debugme.zip mod_debugme
```

Теперь вы можете установить zip-файл на сайт Joomla, который вы используете для тестирования. После установки вам нужно создать модуль Сайта и присвоить его к позиции модуля. Так как это сломанный модуль, вы можете присвоить его позиции на *Всех страницах*, пока работаете над ним; или вы можете присвоить его позиции на одной странице; или вы можете разместить его в статье, у которой есть собственный пункт меню.

После установки удалите zip-файл.

### Включить режим отладки

В глобальной конфигурации Joomla установите *Debug System* на *Yes* и *Error Reporting* на *Maximum*.

Когда вы откроете страницу с ошибочным модулем, вы увидите трассировку стека, показывающую, где произошла ошибка.

![Stack trace](../../../en/images/getting-started/vscode-primer-stack-trace.png)

Иногда ошибка в коде находится на первой строке трассировки стека. В противном случае, если ошибка вызвана в коде библиотеки, например, при передаче недопустимых данных в функцию базы данных, ошибка в коде может находиться ниже в списке вызовов функций.

## Открыть папку расширений в VS Code

В VS Code используйте пункт меню Файл / Открыть папку, чтобы найти и открыть папку, содержащую вашу локальную копию кода расширения *mod_debugme*. Вы должны увидеть что-то похожее на следующее:

![VS Code screen](../../../en/images/getting-started/vscode-primer-screen.png)

Вы можете диагностировать проблему просто прочитав код. В случае ошибки *Класс "DebugHelper" не найден* вы увидите, что ранее несколько строк было закомментировано выражение *use*. Забвение вставить выражение *use* — это распространенная ошибка на этапе начальной разработки!

Исправьте эту проблему, а затем снова сожмите и установите модуль. Этот шаг становится немного утомительным, когда у вас несколько проблем. Вот тут и пригождаются инструменты сборки.

## Инструмент сборки Phing

Phing - это инструмент командной строки, доступный для всех платформ, используемый для сборки программных пакетов с использованием инструкций, хранящихся в xml-файле, который по умолчанию называется build.xml. Для работы с кодом расширений его можно использовать для выполнения двух задач:

- скопируйте измененные файлы из папки источника вашего расширения в правильные места в папке вашего веб-сайта.
- создайте новый ZIP-файл для новых установок.

Загрузите и установите [Phing](https://www.phing.info/). Доступны и другие инструменты сборки! Вы можете установить Phing в свою папку bin или в системную папку bin. Вам нужно запомнить путь к вашему коду Phing. В этом примере это *~/bin/phing-latest.phar*. Вы можете попробовать его с командной строки после перехода в папку с кодом вашего расширения:

```sh
    cd ~/git/j4xdemos-mod-debugme
    php ~/bin/phing-latest.phar
```

Ответ:

```sh
    Buildfile: /Users/ceford/git/j4xdemos-mod-debugme/build.xml

    mod_debugme > main:
          ... Any copied files will be mentioned here
          [zip] Building zip: /Users/ceford/zips/mod_debugme.zip

    BUILD FINISHED

    Total time: 0.0863 seconds
```

## Задачи VS Code

Чтобы запустить Phing из VS Code, вам нужно создать файл *tasks.json* в папке *.vscode* в корне папки *j4xdemos-mod-debugme*. Если последняя не существует, сначала создайте её. Затем создайте файл *tasks.json* и введите следующий код:

```json
    {
        // See https://go.microsoft.com/fwlink/?LinkId=733558
        // for the documentation about the tasks.json format
        "version": "2.0.0",
        "tasks": [
          {
            "label": "Build mod_debugme",
            "type": "shell",
            "command": "php ~/bin/phing-latest.phar",
            "windows": {
              "command": "php ~/bin/phing-latest.phar"
            },
            "group": "build",
            "presentation": {
              "reveal": "always",
              "panel": "shared"
            }
          }
        ]
    }
```

Пользователям Windows необходимо исправить команду, специфичную для Windows. Теперь вы можете создать расширение, используя меню *Terminal / Run Build Task*. Результат команды должен появиться в панели терминала под областью редактирования.

```sh
      *  Executing task: php ~/bin/phing-latest.phar

    Buildfile: /Users/ceford/git/gitdemo/j4xdemos-mod-debugme/build.xml

    mod_debugme > main:

          [zip] Nothing to do: /Users/ceford/zips/mod_debugme.zip is up to date.

    BUILD FINISHED

    Total time: 0.1031 seconds

     *  Terminal will be reused by tasks, press any key to close it.
```

Могут появляться непонятные сообщения об ошибках. Наиболее вероятной причиной является наличие недопустимых путей к папкам в файле *build.xml* или папка не создана. Ещё одна проблема для отладки!

## Отладка

Вы должны быть в состоянии исправить первую ошибку путем инспекции кода. Более сложные проблемы требуют пошагового выполнения кода с отладчиком. Это позволяет вам проверить переменные, чтобы увидеть, содержат ли они ожидаемые вами значения, например, при передаче аргументов в функции библиотеки.

### Настройки *php.ini*

Чтобы настроить отладку с Xdebug, вам нужно внести некоторые записи в начало вашего файла *php.ini*.

```sh
    zend_extension="xdebug.so"
    xdebug.mode="debug"
    xdebug.client_port=9003
    xdebug.start_with_request=yes
    xdebug.log_level=0
```

После сохранения всех изменений перезапустите ваш сервер Apache.

### Добавить окно сайта

Папка вашего расширения содержит всего несколько файлов, ***исходников*** файлов, установленных на вашем сайте. Отладка во время выполнения включает в себя установку точек останова в файлах вашего ***сайта***, поэтому вам нужен доступ к этим файлам. Вы можете использовать меню *Файл / Добавить папку в рабочую область...*, чтобы добавить папку сайта в свою рабочую область. Однако есть очень большая вероятность того, что вы в итоге внесете изменения в файлы сайта, а не в исходные файлы. Поэтому, вероятно, лучше открыть отдельное окно VS Code для отладки.

- **Открыть новое окно:** В меню VS Code выберите *Файл / Новое окно* и выберите папку, содержащую ваш сайт Joomla.
- **Открыть папку:** В вновь открывшемся окне выберите *Файл / Открыть папку...* в меню VS Code. Найдите папку вашего сайта и выберите ее. Вы должны увидеть список всех файлов вашего сайта Joomla в основной боковой панели.

### Конфигурация запуска

Чтобы отладка действительно работала в VS Code, вам нужна конфигурация запуска. В корне вашего веб-сайта создайте папку с именем *.vscode* (обратите внимание на начальную точку), содержащую файл с именем *launch.json* со следующим содержимым:

```json
    {
        "configurations": [
            {
                "name": "Listen for XDebug",
                "type": "php",
                "request": "launch",
                "hostname": "0.0.0.0",
                "port": 9003,
                "stopOnEntry": true,
                "pathMappings": {
                    "/Users/ceford/Sites/j421rc2": "${workspaceFolder}"
                }
            }
        ]
    }
```

Не забудьте заменить элемент pathMappings в этом примере на актуальные pathMappings вашего сайта. Элемент stopOnEntry остановит выполнение на самой первой строке исполняемого PHP кода.

### Отладка *mod_debugme*

Теперь вы готовы найти и исправить ошибки в установленном модуле.

- **Найдите код модуля:** Найдите первую ошибку на строке 16 файла JROOT/modules/mod_debugme/mod_debugme.php.
- **Установите точку останова:** Щелкните в пространстве слева от номера 16. Когда вы наведете курсор, появится бледно-красный кружок, который станет полностью красным после нажатия, указывая на то, что точка останова установлена.
- **Начните отладку:** В меню VS Code выберите *Запуск / Запустить отладку*. В вашем браузере перезагрузите ваш сайт. Окно VS Code должно снова появиться с кодом, остановленным на первой строке файла *index.php* сайта. В верхней части экрана находятся несколько значков для управления процессом отладки. Они должны быть интуитивно понятны. Если нет, обратитесь к справке / документации VS Code.
- **Продолжить:** Выберите кнопку продолжения - код выполнится до вашей первой точки останова. Исследуйте код, чтобы определить, в чем проблема.
- **Наведение курсора:** Если вы наведете курсор на переменную, которой присвоено значение, появится маленькая всплывающая подсказка, резюмирующая атрибуты этой переменной. Для переменных, которым не присвоены значения, всплывающая подсказка отсутствует.
- **Переменные:** Левый столбец содержит больше информации о состоянии кода в точке останова. Их слишком много, чтобы охватить здесь. Изучите их по мере необходимости!
- **Остановить отладку:** Вероятно, лучше всего выбрать значок "Продолжить", иначе веб-страница будет доставлена пустой. В противном случае вы можете использовать кнопку "Остановить" или меню "Запуск / Остановить отладку".

### Исправить ошибку

**Помните:** не исправляйте ошибку в коде сайта! Исправьте её в исходном коде!

Исправьте исходный код и затем используйте *Terminal / Run Build Task...*.

Перезапустить отладку.

### Советы

Несколько неочевидных проблем:

- Вы исправляете первую ошибку, но на этой строке приложение всё ещё падает. Проверьте файл mod_debugme.xml, чтобы увидеть, где определён src классов с пространством имен. Когда исправите в исходном коде, вам нужно будет переустановить zip-файл или удалить *administrator/cache/autoload_psr4.php*. Когда этот файл отсутствует, Joomla восстанавливает его из манифест-файлов. Но если в нём есть некорректная или отсутствующая запись, она не будет исправлена, пока расширение не будет переустановлено.
- Иногда вам нужно установить точку останова за несколько строк до строки, где происходит ошибка, особенно если вы хотите проверить значения, передаваемые в вызовы функций.
- Таблица *xxx.yyy\\debugme* не существует. Ах да, код для создания таблицы при установке и её удаления при деинсталляции не был создан. Вам нужно будет выполнить SQL-запрос в phpMyAdmin, используя содержимое файла *mod\\debugme.sql*. Не забудьте изменить *\#\\* в названиях таблиц на префикс вашей базы данных. И если всё ещё не удаётся, проверьте название таблицы в коде.

## Скриншот

Когда всё будет исправлено, вы можете увидеть следующее:

![Site view of debugged module working](../../../en/images/getting-started/vscode-primer-debugme-fixed.png)

Дни торта?

## Ссылки

Из документации Joomla!: [Visual Studio Code](https://docs.joomla.org/Visual_Studio_Code "Visual Studio Code"), который также охватывает настройку других инструментов, например, CodeSniffer и PHPUnit.

*Переведено сайтом openai.com*

